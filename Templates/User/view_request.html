<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Book Requests</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      background-color: #fff8e7; /* cream background */
      font-family: "Segoe UI", sans-serif;
    }
    .req-card {
      background: #fffefc;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      padding: 20px;
    }
    .req-card h5 {
      color: #6c4a2e;
      font-weight: 600;
    }
    .req-info {
      color: #444;
    }
    .btn-accept {
      background-color: #d4a373;
      border: none;
      color: white;
    }
    .btn-accept:hover {
      background-color: #b5835a;
    }
    .btn-reject {
      background-color: #e6b8b8;
      border: none;
      color: #6b2e2e;
    }
    .btn-reject:hover {
      background-color: #d98c8c;
    }
    .section-title {
      color: #6c4a2e;
      font-weight: bold;
      margin-top: 40px;
      margin-bottom: 20px;
      border-bottom: 2px solid #d4a373;
      display: inline-block;
      padding-bottom: 6px;
    }
  </style>
</head>
<body>

<div class="container mt-5">
  <h2 class="mb-4 text-center" style="color:#6c4a2e;">
    <i class="bi bi-journal-text"></i> Book Requests
  </h2>

  <!-- ================= BUY REQUESTS ================= -->
  <h4 class="section-title"><i class="bi bi-bag"></i> Purchase Requests</h4>
  {% for i in data %}
  <div class="req-card">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h5><i class="bi bi-book"></i> {{ i.BOOK.name }} </h5>
        <p class="req-info mb-1"><strong>Date:</strong> {{ i.date }}</p>
        <p class="req-info mb-1"><strong>Status:</strong> {{ i.status }}</p>
        <p class="req-info mb-1"><strong>Requested By:</strong> {{ i.USER.name }}</p>
      </div>
      <div class="col-md-4 text-md-end text-center mt-3 mt-md-0">

        {% if i.status == "paid" %}
          <button class="btn btn-success" disabled>
            <i class="bi bi-bag-check"></i> Approved Purchase
          </button>

        {% elif i.status == "pending" %}
          <form action="/Myapp/AcceptRequest/{{ i.id }}/" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-accept">
              <i class="bi bi-check-circle"></i> Accept
            </button>
          </form>
          <form action="/Myapp/RejectRequest/{{ i.id }}/" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-reject">
              <i class="bi bi-x-circle"></i> Reject
            </button>
          </form>

        {% elif i.status == "Accepted" %}
          <a href="/Myapp/chat/{{ i.USER.LOGIN.id }}/" class="btn btn-outline-primary me-2">
            <i class="bi bi-chat-dots"></i> Chat
          </a>


        {% elif i.status == "Rejected" %}
          <button class="btn btn-reject" disabled>
            <i class="bi bi-x-circle"></i> Rejected
          </button>
        {% endif %}

      </div>
    </div>
  </div>
  {% empty %}
  <p class="text-muted">No purchase requests available.</p>
  {% endfor %}

  <!-- ================= RENT REQUESTS ================= -->
  <h4 class="section-title"><i class="bi bi-house-door"></i> Rent Requests</h4>
  {% for r in rent %}
  <div class="req-card">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h5><i class="bi bi-book"></i> {{ r.BOOK.name }} </h5>
        <p class="req-info mb-1"><strong>Date:</strong> {{ r.date }}</p>
        <p class="req-info mb-1"><strong>Status:</strong> {{ r.status }}</p>
        <p class="req-info mb-1"><strong>Requested By:</strong> {{ r.USER.name }}</p>
      </div>
      <div class="col-md-4 text-md-end text-center mt-3 mt-md-0">

        {% if r.status == "paid" %}
          <button class="btn btn-success" disabled>
            <i class="bi bi-house-check"></i> Approved Rent
          </button>
              <a href="" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#sendNotificationModal">
            <i class="bi bi-credit-card"></i> Send Notification
          </a>
             <style>
    .modal-header {
      background-color: #fdf6ec;
      border-bottom: 1px solid #e5d5c3;
    }
    .modal-title {
      color: #4b3f2f;
      font-weight: bold;
    }
    .btn-send {
      background-color: #8c6239;
      color: #fff;
      border-radius: 10px;
      padding: 8px 18px;
    }
    .btn-send:hover {
      background-color: #6d4b29;
    }
  </style>
</head>
<body>

<div class="container text-center mt-5">


<!-- Modal -->
<div class="modal fade" id="sendNotificationModal" tabindex="-1" aria-labelledby="sendNotificationLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="sendNotificationLabel">Send Notification</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <form method="post" action="/Myapp/SendNotificationPost/{{ r.id }}/">
        {% csrf_token %}
        <div class="modal-body">
          <div class="mb-3">
            <label for="notificationText" class="form-label">Notification Message</label>
            <textarea class="form-control" id="notificationText" name="notification" rows="4" placeholder="Write your notification here..." required></textarea>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-send">
            <i class="bi bi-send"></i> Send
          </button>
        </div>
      </form>

    </div>
  </div>
</div>

        {% elif r.status == "pending" %}
          <form action="/Myapp/AcceptRentRequest/{{ r.id }}/" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-accept">
              <i class="bi bi-check-circle"></i> Accept
            </button>
          </form>
          <form action="/Myapp/RejectRentRequest/{{ r.id }}/" method="post" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-reject">
              <i class="bi bi-x-circle"></i> Reject
            </button>
          </form>

        {% elif r.status == "Accepted" %}
          <a href="/Myapp/chat/{{ r.USER.LOGIN.id }}/" class="btn btn-outline-primary me-2">
            <i class="bi bi-chat-dots"></i> Chat
          </a>


        {% elif r.status == "Rejected" %}
          <button class="btn btn-reject" disabled>
            <i class="bi bi-x-circle"></i> Rejected
          </button>
        {% endif %}

      </div>
    </div>
  </div>
  {% empty %}
  <p class="text-muted">No rent requests available.</p>
  {% endfor %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
